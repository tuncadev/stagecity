(function(A){"use strict";var E=civi_template_vars.ajax_url,I=civi_template_vars.item_amount,N=civi_template_vars.map_effects,w=civi_candidate_archive_vars.not_candidate;var i=false;var T=A(".civi-menu-filter");var j=A(".maptype").data("maptype");var P=false;var z="";if(j=="google_map"){var e=A("#candidate-map-filter")}else if(j=="openstreetmap"){var e=A("#maps")}else{var e=A("#map")}if(e.length){z="yes"}if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){P=true}var O=function(){if(N!==""&&z){A(".map-event .area-candidates .civi-candidates-item").each(function(){var e=A(this).find(".add-follow-candidate").data("candidate-id");if(j=="google_map"){A(this).on("mouseenter",function(){if(N=="popup"){A('div[title="marker'+e+'"]').trigger("click").css("z-index","2")}else if(N=="shine"){A('div[title="marker'+e+'"]').trigger("click").addClass("mouseenter")}});A(this).on("mouseleave",function(){if(N=="popup"){A('div[title="marker'+e+'"]').css("z-index","0");infowindow.open(null,null)}else if(N=="shine"){A('div[title="marker'+e+'"]').trigger("click").removeClass("mouseenter")}})}else if(j=="openstreetmap"){A(this).on("mouseenter",function(){if(N=="popup"){A(".marker-"+e).trigger("click").css("z-index","2")}else if(N=="shine"){A(".marker-"+e).trigger("click").addClass("mouseenter")}});A(this).on("mouseleave",function(){if(N=="popup"){A(".marker-"+e).css("z-index","0");A(".leaflet-popup-close-button").trigger("click")}else if(N=="shine"){A(".marker-"+e).trigger("click").removeClass("mouseenter")}})}else{A(this).on("mouseenter",function(){if(N=="popup"){A("#marker-"+e).trigger("click").css("z-index","2")}else if(N=="shine"){A("#marker-"+e).trigger("click").addClass("mouseenter")}});A(this).on("mouseleave",function(){if(N=="popup"){A(".marker-"+e).css("z-index","0");A(".mapboxgl-popup-close-button").trigger("click")}else if(N=="shine"){A("#marker-"+e).trigger("click").removeClass("mouseenter")}})}})}};CANDIDATE.elements={init:function(){this.candidate_layout();this.pagination();this.display_clear();this.filter_clear_top();this.filter_clear();A(".civi-menu-filter").on("input","input.input-control",function(){A(".civi-pagination").find('input[name="paged"]').val(1);A(".form-candidate-top-filter .btn-top-filter").removeData("clicked");i=true;CANDIDATE.elements.ajax_load(i)});A(".archive-layout select.sort-by").on("change",function(){A(".civi-pagination").find('input[name="paged"]').val(1);A(".form-candidate-top-filter .btn-top-filter").removeData("clicked");i=true;CANDIDATE.elements.ajax_load(i)});A(".form-candidate-top-filter .btn-top-filter").on("click",function(e){e.preventDefault();A(".civi-pagination").find('input[name="paged"]').val(1);A(this).data("clicked",true);i=true;CANDIDATE.elements.ajax_load(i)});if(e.length>0){CANDIDATE.elements.ajax_load()}A('.btn-hide-map input[type="checkbox"]').on("change",function(){var e=A(".archive-layout .inner-content");var a=A(".layout-top-filter .nav-bar");if(A(this).attr("checked")){A("input[value='hide_map']").prop("checked",false)}else{A("input[value='hide_map']").prop("checked",true)}if(e.hasClass("has-map")){e.removeClass("has-map");e.addClass("no-map");a.removeClass("has-map");a.addClass("no-map")}else{e.removeClass("no-map");e.addClass("has-map");a.removeClass("no-map");a.addClass("has-map")}i=true;CANDIDATE.elements.ajax_load(i)})},pagination:function(){A("body").on("click",".civi-pagination.ajax-call a.page-numbers",function(e){e.preventDefault();A(".civi-pagination .pagination").addClass("active");A(".civi-pagination li .page-numbers").removeClass("current");A(this).addClass("current");var a=A(this).text();var t=1;if(A(".civi-pagination").find('input[name="paged"]').val()){t=A(".civi-pagination").find('input[name="paged"]').val()}if(A(this).hasClass("next")){a=parseInt(t)+1}if(A(this).hasClass("prev")){a=parseInt(t)-1}A(".civi-pagination").find('input[name="paged"]').val(a);i=true;if(A(this).attr("data-type")=="number"){CANDIDATE.elements.scroll_to(".area-candidates");CANDIDATE.elements.ajax_load(i)}else{CANDIDATE.elements.ajax_load(i,"loadmore")}})},removeClassStartingWith:function(e,t){e.removeClass(function(e,a){return(a.match(new RegExp("\\b"+t+"\\S+","g"))||[]).join(" ")})},candidate_layout:function(){A(".candidate-layout a").on("click",function(e){e.preventDefault();var a=A(this).attr("data-layout");var t=A(".civi-pagination").attr("data-type");if(t=="loadmore"){A(".civi-pagination").find('input[name="paged"]').val(1)}A(this).closest(".candidate-layout").find("a").removeClass("active");A(this).addClass("active");CANDIDATE.elements.removeClassStartingWith(A(".archive-layout>.inner-content"),"layout-");A(this).closest(".inner-content").addClass(a);A(".form-candidate-top-filter .btn-top-filter").removeData("clicked");A(".area-candidates .civi-candidates-item").each(function(){CANDIDATE.elements.removeClassStartingWith(A(this),"layout-");A(this).addClass(a)});i=true;CANDIDATE.elements.ajax_load(i)})},display_clear:function(){var e=A(".archive-candidate");if(A(".civi-menu-filter ul.filter-control li.active").length>0){A(".civi-nav-filter").addClass("active");e.find(".civi-clear-filter").show()}else{A(".civi-nav-filter").removeClass("active");e.find(".civi-clear-filter").hide()}A('.civi-menu-filter input[type="checkbox"]:checked').each(function(){if(A(this).length>0){A(".civi-nav-filter").addClass("active");A(this).closest(".entry-filter").addClass("open");e.find(".civi-clear-filter").show()}else{A(".civi-nav-filter").removeClass("active");A(this).closest(".entry-filter").removeClass("open");e.find(".civi-clear-filter").hide()}})},filter_clear_top:function(){A(".civi-clear-top-filter").on("click",function(){A('.form-candidate-top-filter input[name="candidate_filter_search"]').val("");A(".form-candidate-top-filter .nice-select").val("");A(".form-candidate-top-filter .nice-select").niceSelect("update");i=true;CANDIDATE.elements.ajax_load(i)})},filter_clear:function(){A(".civi-clear-filter").on("click",function(){A(".civi-menu-filter ul.filter-control li").removeClass("active");A('.civi-menu-filter input[type="checkbox"]').prop("checked",false);i=true;CANDIDATE.elements.ajax_load(i)})},ajax_load:function(a,t){var e,i,n,r,o,l,c,s,d,p,m,f,v,u,g;var h=1;h=A(".civi-pagination").find('input[name="paged"]').val();e=A('input[name="candidate_filter_search"]').val();l=A('input[name="current_term"]').val();c=A('input[name="type_term"]').val();s=A(".candidate-layout a.active").attr("data-layout");i=T.find(".sort-by.filter-control li.active a").data("sort");var _=A('.archive-layout select[name="sort_by"]').val();if(_){i=_}u=A('input[name="search_fields_sidebar"]').val();var y=A.parseJSON(u);if(y.hasOwnProperty("candidate_locations")){r=A('input[name="candidate_locations_id[]"]:checked').map(function(){return A(this).val()}).get()}else{r=A('select[name="candidate_locations"]').val()}if(y.hasOwnProperty("candidate_categories")){n=A('input[name="candidate_categories_id[]"]:checked').map(function(){return A(this).val()}).get()}else{n=A('select[name="candidate_categories"]').val()}if(y.hasOwnProperty("candidate_rating")){o=A('input[name="candidate_rating[]"]:checked').map(function(){return A(this).val()}).get()}else{o=A('select[name="candidate_rating"]').val()}if(y.hasOwnProperty("candidate_yoe")){d=A('input[name="candidate_yoe_id[]"]:checked').map(function(){return A(this).val()}).get()}else{d=A('select[name="candidate_yoe"]').val()}if(y.hasOwnProperty("candidate_qualification")){p=A('input[name="candidate_qualification_id[]"]:checked').map(function(){return A(this).val()}).get()}else{p=A('select[name="candidate_qualification"]').val()}if(y.hasOwnProperty("candidate_ages")){m=A('input[name="candidate_ages_id[]"]:checked').map(function(){return A(this).val()}).get()}else{m=A('select[name="candidate_ages"]').val()}if(y.hasOwnProperty("candidate_skills")){f=A('input[name="candidate_skills_id[]"]:checked').map(function(){return A(this).val()}).get()}else{f=A('select[name="candidate_skills"]').val()}if(y.hasOwnProperty("candidate_languages")){v=A('input[name="candidate_languages_id[]"]:checked').map(function(){return A(this).val()}).get()}else{v=A('select[name="candidate_languages"]').val()}if(y.hasOwnProperty("candidate_gender")){g=A('input[name="candidate_gender[]"]:checked').map(function(){return A(this).val()}).get()}else{g=A('select[name="candidate_gender"]').val()}var k=A(".maptype").clone();if(j=="google_map"){}else if(j=="openstreetmap"){var C=function(e,a){A(".maptype").remove();A(k).insertAfter("#pac-input");var t=A("#maps").data("key");var i=A("#maps").data("level");var n=A("#maps").data("style");var r=[];var o=[];var l=[];A.each(e,function(e,a){r.push({type:"Feature",geometry:{type:"Point",coordinates:[a.lat,a.lng]},properties:{iconSize:[40,40],id:a.id,icon:a.marker_icon,candidate:a.candidate}});o.push(a.lng);l.push(a.lat)});var c={type:"FeatureCollection",features:r};var s=0;for(var d=0;d<o.length;d++){s+=parseInt(o[d],10)}var p=0;if(s/o.length){p=s/o.length}var m=0;for(var d=0;d<l.length;d++){m+=parseInt(l[d],10)}var f=0;if(m/l.length){f=m/l.length}var v=L.DomUtil.get("maps");if(v!=null){v._leaflet_id=null}A(".leaflet-map-pane").remove();A(".leaflet-control-container").remove();var u=new L.map("maps");u.on("load",g);u.setView([f,p],i);function g(){var e="mapbox/"+n;L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token="+t,{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',id:e,tileSize:512,zoomOffset:-1,accessToken:t}).addTo(u);_()}function h(e){u.flyTo(e.geometry.coordinates,i)}if(!("remove"in Element.prototype)){Element.prototype.remove=function(){if(this.parentNode){this.parentNode.removeChild(this)}}}function _(){c.features.forEach(function(t){var e=document.createElement("div");e.id="marker-"+t.properties.id;e.className="marker";e.style.backgroundImage="url("+t.properties.icon+")";e.style.width=t.properties.iconSize[0]+"px";e.style.height=t.properties.iconSize[1]+"px";e:{}var a=L.divIcon({className:"marker-"+t.properties.id,html:'<div><img src="'+t.properties.icon+'" alt=""></div>',iconSize:[48,48]});var i=new L.marker([t.geometry.coordinates[0],t.geometry.coordinates[1]],{icon:a});i.addTo(u);if(N=="popup"){i.bindPopup(t.properties.candidate)}else{i.bindPopup()}e.addEventListener("click",function(e){h(t);var a=document.getElementsByClassName("active");e.stopPropagation();if(a[0]){a[0].classList.remove("active")}})})}if(!P){O()}}}else{var b=function(e,i){var a=A("#map").data("key");var t=A("#map").data("level");var n=A("#map").data("type");mapboxgl.accessToken=a;A(".mapboxgl-canary").remove();A(".mapboxgl-canvas-container").remove();A(".mapboxgl-control-container").remove();var r=[];var o=[];var l=[];A.each(e,function(e,a){r.push({type:"Feature",geometry:{type:"Point",coordinates:[a.lng,a.lat]},properties:{iconSize:[48,48],id:a.id,icon:a.marker_icon,candidate:a.candidate}});o.push(a.lng);l.push(a.lat)});var c=0;for(var s=0;s<o.length;s++){c+=parseInt(o[s],10)}var d=0;if(c/o.length){d=c/o.length}var p=0;for(var s=0;s<l.length;s++){p+=parseInt(l[s],10)}var m=0;if(p/l.length){m=p/l.length}var i=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/"+n,zoom:t,center:[d,m]});i.addControl(new mapboxgl.NavigationControl);var f={type:"FeatureCollection",features:r};i.on("load",function(e){i.addLayer({id:"locations",type:"symbol",source:{type:"geojson",data:f},layout:{"icon-image":"","icon-allow-overlap":true}});g()});function v(e){i.flyTo({center:e.geometry.coordinates,bearing:0,duration:0,speed:.2,curve:1,easing:function(e){return e}})}function u(e){var a=document.getElementsByClassName("mapboxgl-popup");if(a[0])a[0].remove();var t=new mapboxgl.Popup({closeOnClick:false}).setLngLat(e.geometry.coordinates).setHTML(e.properties.candidate).addTo(i)}if(!("remove"in Element.prototype)){Element.prototype.remove=function(){if(this.parentNode){this.parentNode.removeChild(this)}}}i.on("click",function(e){var a=i.queryRenderedFeatures(e.point,{layers:["locations"]});if(a.length){var t=a[0];v(t);u(t)}});function g(){f.features.forEach(function(t){var e=document.createElement("div");e.id="marker-"+t.properties.id;e.className="marker";e.style.backgroundImage="url("+t.properties.icon+")";e.style.width=t.properties.iconSize[0]+"px";e.style.height=t.properties.iconSize[1]+"px";new mapboxgl.Marker(e,{offset:[0,-23]}).setLngLat(t.geometry.coordinates).addTo(i);e.addEventListener("click",function(e){v(t);if(N=="popup"){u(t)}var a=document.getElementsByClassName("active");e.stopPropagation();if(a[0]){a[0].classList.remove("active")}})})}};if(!P){O()}}CANDIDATE.elements.display_clear();var x=A(".area-candidates").attr("data-item-amount");if(x){I=x}var D=A(".civi-pagination").attr("data-type");A(".area-candidates .civi-candidates-item").addClass("skeleton-loading");A.ajax({dataType:"json",url:E,data:{action:"civi_candidate_archive_ajax",paged:h,title:e,item_amount:I,sort_by:i,current_term:l,type_term:c,rating:o,location:r,categories:n,candidate_layout:s,candidate_yoe_id:d,candidate_qualification_id:p,candidate_ages_id:m,candidate_skills_id:f,candidate_languages_id:v,candidate_gender:g},beforeSend:function(){A(".civi-filter-search-map .civi-loading-effect").fadeIn();if(A(".form-candidate-top-filter .btn-top-filter").data("clicked")){A(".btn-top-filter .btn-loading").fadeIn()}},success:function(e){A(".btn-top-filter .btn-loading").fadeOut();A(".civi-filter-search-map .civi-loading-effect").fadeOut();A(".area-candidates .civi-candidates-item").removeClass("skeleton-loading");if(e.success===true){if(a==true){if(e.pagination_type=="number"||t!=="loadmore"){A(".area-candidates").html(e.candidate_html);A(".filter-neighborhood").html(e.filter_html);A(".civi-pagination .pagination").html(e.pagination);A(".archive-layout .result-count").html(e.count_post)}else{A(".area-candidates").append(e.candidate_html);A(".filter-neighborhood").html(e.filter_html);if(e.hidden_pagination){A(".civi-pagination .pagination").html("")}A(".civi-pagination .pagination").removeClass("active")}}}else{if(a==true){if(e.pagination_type=="number"||t!=="loadmore"){A(".area-candidates").html('<div class="civi-ajax-result">'+w+"</div>");A(".archive-layout .result-count").html(e.count_post);A(".civi-pagination .pagination").html("")}else{A(".area-candidates").append(e.candidate_html);if(e.hidden_pagination){A(".civi-pagination .pagination").html("")}A(".civi-pagination .pagination").removeClass("active")}}}if(!P){O()}if(z){if(j=="google_map"){}else if(j=="openstreetmap"){C(e.candidate,maps)}else{b(e.candidate,map)}}}})}};CANDIDATE.onReady={init:function(){CANDIDATE.elements.init()}};CANDIDATE.onLoad={init:function(){}};A(document).ready(function(){CANDIDATE.elements.init()});A(window).load(CANDIDATE.onLoad.init)})(jQuery);