(function(w){"use strict";var O=civi_template_vars.ajax_url,B=civi_template_vars.item_amount,J=civi_template_vars.map_effects,e=civi_template_vars.marker_default_icon,z=civi_template_vars.not_jobs;var I=[];var P;var n;var E=w(".civi-menu-filter");E.each(function(){if(w(this).closest(".archive-filter").is(":visible")){E=w(this)}});var t=w(".maptype").data("maptype");if(t=="google_map"){n=w("#jobs-map-filter")}else if(t=="openstreetmap"){n=w("#maps")}else{n=w("#map")}var T="";if(n.length){T="yes"}var o=false;var N=false;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){N=true}var D=function(){if(J!==""&&T){w(".map-event .area-jobs .civi-jobs-item").each(function(e){var i=w(this).find(".btn-add-to-wishlist").data("jobs-id");if(t=="google_map"){w(this).on("mouseenter",function(){if(J=="popup"){w('div[title="marker'+i+'"]').trigger("click").css("z-index","2")}else if(J=="shine"){w('div[title="marker'+i+'"]').trigger("click").addClass("mouseenter")}});w(this).on("mouseleave",function(){if(J=="popup"){w('div[title="marker'+i+'"]').css("z-index","0");infowindow.open(null,null)}else if(J=="shine"){w('div[title="marker'+i+'"]').trigger("click").removeClass("mouseenter")}})}else if(t=="openstreetmap"){w(this).on("mouseenter",function(){if(J=="popup"){w(".marker-"+i).trigger("click").css("z-index","2")}else if(J=="shine"){w(".marker-"+i).trigger("click").addClass("mouseenter")}});w(this).on("mouseleave",function(){if(J=="popup"){w(".marker-"+i).css("z-index","0");w(".leaflet-popup-close-button").trigger("click")}else if(J=="shine"){w(".marker-"+i).trigger("click").removeClass("mouseenter")}})}else{w(this).on("mouseenter",function(){if(J=="popup"){w("#marker-"+i).trigger("click").css("z-index","2")}else if(J=="shine"){w("#marker-"+i).trigger("click").addClass("mouseenter")}});w(this).on("mouseleave",function(){if(J=="popup"){w(".marker-"+i).css("z-index","0");w(".mapboxgl-popup-close-button").trigger("click")}else if(J=="shine"){w("#marker-"+i).trigger("click").removeClass("mouseenter")}})}})}};JOBS.elements={init:function(){this.waypoints();this.jobs_layout();this.pagination();this.filter_single();this.filter_clear_top();this.filter_clear();this.display_clear();var e=w(".civi-menu-filter");var i=w(".form-jobs-top-filter ");if(w(window).width()>992){w(".btn-canvas-filter.hidden-md-up").remove();w("select.hidden-md-up").remove()}if(n.length>0){JOBS.elements.ajax_load()}w(".civi-menu-filter").on("input","input.input-control",function(){w(".civi-pagination").find('input[name="paged"]').val(1);w(".form-jobs-top-filter .btn-top-filter").removeData("clicked");o=true;JOBS.elements.ajax_load(o)});w(".archive-jobs select.sort-by").on("change",function(){w(".civi-pagination").find('input[name="paged"]').val(1);w(".form-jobs-top-filter .btn-top-filter").removeData("clicked");o=true;JOBS.elements.ajax_load(o)});function t(t,a){var n=0;return function(){var e=this,i=arguments;clearTimeout(n);n=setTimeout(function(){t.apply(e,i)},a||0)}}e.find('input[name="jobs_filter_salary_min"]').keyup(t(function(){w(".civi-pagination").find('input[name="paged"]').val(1);w(".form-jobs-top-filter .btn-top-filter").removeData("clicked");o=true;JOBS.elements.ajax_load(o)},1e3));e.find('input[name="jobs_filter_salary_max"]').keyup(t(function(){w(".civi-pagination").find('input[name="paged"]').val(1);w(".form-jobs-top-filter .btn-top-filter").removeData("clicked");o=true;JOBS.elements.ajax_load(o)},1e3));e.find('select[name="jobs_filter_rate"]').on("change",function(){w(".civi-pagination").find('input[name="paged"]').val(1);w(".form-jobs-top-filter .btn-top-filter").removeData("clicked");o=true;JOBS.elements.ajax_load(o)});w(".form-jobs-top-filter .btn-top-filter").on("click",function(e){e.preventDefault();w(".civi-pagination").find('input[name="paged"]').val(1);w(this).data("clicked",true);o=true;JOBS.elements.ajax_load(o)});var a;w(".civi-ajax-search").on("keyup input focus","input",function(){var i=w(this);if(i.val()){clearInterval(a);a=setTimeout(function(){if(i.attr("name")=="s"){JOBS.elements.ajax_search(i)}if(i.attr("name")=="jobs_location"){var e=i.closest(".civi-ajax-search").find('input[name="s"]');JOBS.elements.ajax_search(e,"hide");JOBS.elements.ajax_search_location(i,"show")}},200)}else{clearInterval(a)}});w(".civi-ajax-search").on("focus input","input",function(){var e=w(this);w(".form-field .area-result").hide();if(e.val()){e.closest(".area-search").find(".focus-result").hide();e.closest(".form-field").find(".area-result").show()}else{e.closest(".form-field").find(".focus-result").show();e.closest(".form-field").find(".area-result").hide()}});w("body").on("click",".civi-filter-search-map .btn-close",function(e){e.preventDefault();w("body").css("overflow","inherit");w(".civi-filter-search-map").fadeOut();o=false});w('.btn-hide-map input[type="checkbox"]').on("change",function(){var e=w(".archive-layout .inner-content");var i=w(".layout-top-filter .nav-bar");if(w(this).attr("checked")){w("input[value='hide_map']").prop("checked",false)}else{w("input[value='hide_map']").prop("checked",true)}if(e.hasClass("has-map")){e.removeClass("has-map");e.addClass("no-map");i.removeClass("has-map");i.addClass("no-map")}else{e.removeClass("no-map");e.addClass("has-map");i.removeClass("no-map");i.addClass("has-map")}o=true;JOBS.elements.ajax_load(o)});w(".toggle-select").on("click",".toggle-show",function(){w(this).closest(".toggle-select").find(".toggle-list").slideToggle()})},waypoints:function(){var e=w(".offset-item");var i=e.waypoint(function(e){var i=this.element?this.element:this;var t=w(i);t.addClass("animate")},{offset:"85%",triggerOnce:true})},pagination:function(){w("body").on("click",".civi-pagination.ajax-call a.page-numbers",function(e){e.preventDefault();w(".civi-pagination .pagination").addClass("active");w(".civi-pagination li .page-numbers").removeClass("current");w(this).addClass("current");var i=w(this).text();var t=1;if(w(".civi-pagination").find('input[name="paged"]').val()){t=w(".civi-pagination").find('input[name="paged"]').val()}if(w(this).hasClass("next")){i=parseInt(t)+1}if(w(this).hasClass("prev")){i=parseInt(t)-1}w(".civi-pagination").find('input[name="paged"]').val(i);o=true;if(w(this).attr("data-type")=="number"){JOBS.elements.scroll_to(".area-jobs");JOBS.elements.ajax_load(o)}else{JOBS.elements.ajax_load(o,"loadmore")}})},removeClassStartingWith:function(e,t){e.removeClass(function(e,i){return(i.match(new RegExp("\\b"+t+"\\S+","g"))||[]).join(" ")})},jobs_layout:function(){w(".jobs-layout a").on("click",function(e){e.preventDefault();var i=w(this).attr("data-layout");var t=w(".civi-pagination").attr("data-type");if(t=="loadmore"){w(".civi-pagination").find('input[name="paged"]').val(1)}w(this).closest(".jobs-layout").find(">a").removeClass("active");w(this).addClass("active");JOBS.elements.removeClassStartingWith(w(".archive-layout>.inner-content"),"layout-");w(this).closest(".inner-content").addClass(i);w(".form-jobs-top-filter .btn-top-filter").removeData("clicked");w(".area-jobs .civi-jobs-item").each(function(){JOBS.elements.removeClassStartingWith(w(this),"layout-");w(this).addClass(i)});o=true;JOBS.elements.ajax_load(o)})},display_clear:function(){var e=w(".archive-jobs");if(w(".civi-menu-filter ul.filter-control li.active").length>0){w(".civi-nav-filter").addClass("active")}else{w(".civi-nav-filter").removeClass("active")}if(w('.civi-menu-filter input[name="jobs_filter_salary_min"]').val()!==""||w('.civi-menu-filter input[name="jobs_filter_salary_max"]').val()!==""||w('.civi-menu-filter select[name="jobs_filter_rate"]').val()!==""){e.find(".civi-clear-filter").show()}else{e.find(".civi-clear-filter").hide()}w('.civi-menu-filter input[type="checkbox"]:checked').each(function(){if(w(this).length>0){w(".civi-nav-filter").addClass("active");w(this).closest(".entry-filter").addClass("open");e.find(".civi-clear-filter").show()}else{w(".civi-nav-filter").removeClass("active");w(this).closest(".entry-filter").removeClass("open");e.find(".civi-clear-filter").hide()}});w(".civi-menu-filter .entry-filter").each(function(){if(w(this).find('input[type="checkbox"]:checked').length>0){w(this).addClass("open")}else{w(this).removeClass("open")}})},filter_clear_top:function(){w(".civi-clear-top-filter").on("click",function(){w('.form-jobs-top-filter input[name="jobs_filter_search"]').val("");w(".form-jobs-top-filter .nice-select").val("");w(".form-jobs-top-filter .nice-select").niceSelect("update");o=true;JOBS.elements.ajax_load(o)})},filter_clear:function(){w(".civi-clear-filter").on("click",function(){w(".civi-menu-filter ul.filter-control li").removeClass("active");w('.civi-menu-filter input[type="checkbox"]').prop("checked",false);w('.civi-menu-filter input[name="jobs_filter_salary_min"]').val("");w('.civi-menu-filter input[name="jobs_filter_salary_max"]').val("");w('.civi-menu-filter select[name="jobs_filter_rate"]').prop("selectedIndex",0);o=true;JOBS.elements.ajax_load(o)})},filter_single:function(){w(".civi-menu-filter ul.filter-control a").on("click",function(e){e.preventDefault();w(".civi-pagination").find('input[name="paged"]').val(1);if(w(this).parent().hasClass("active")){w(this).parents(".civi-menu-filter ul.filter-control").find("li").removeClass("active");w(this).closest(".entry-filter").removeClass("open")}else{w(this).parents(".civi-menu-filter ul.filter-control").find("li").removeClass("active");w(this).parent().addClass("active");w(this).closest(".entry-filter").addClass("open")}o=true;JOBS.elements.ajax_load(o)})},ajax_load:function(o,r){var e,i,t,a,n,s,l,c,t,p,m,f,v,u,c,d,g;var h=1;var _=w(".maptype").clone();h=w(".civi-pagination").find('input[name="paged"]').val();e=w('input[name="jobs_filter_search"]').val();m=w('input[name="current_term"]').val();f=w('input[name="type_term"]').val();d=w(".jobs-layout a.active").attr("data-layout");g=w('input[name="search_fields_sidebar"]').val();var b=w.parseJSON(g);if(b.hasOwnProperty("jobs-location")){c=w('input[name="jobs-location_id[]"]:checked').map(function(){return w(this).val()}).get()}else{c=w('select[name="jobs-location"]').val()}if(b.hasOwnProperty("jobs-categories")){t=w('input[name="jobs-categories_id[]"]:checked').map(function(){return w(this).val()}).get()}else{t=w('select[name="jobs-categories"]').val()}if(b.hasOwnProperty("jobs-skills")){l=w('input[name="jobs-skills_id[]"]:checked').map(function(){return w(this).val()}).get()}else{l=w('select[name="jobs-skills"]').val()}if(b.hasOwnProperty("jobs-type")){a=w('input[name="jobs-type_id[]"]:checked').map(function(){return w(this).val()}).get()}else{a=w('select[name="jobs-type"]').val()}if(b.hasOwnProperty("jobs-experience")){n=w('input[name="jobs-experience_id[]"]:checked').map(function(){return w(this).val()}).get()}else{n=w('select[name="jobs-experience"]').val()}if(b.hasOwnProperty("jobs-career")){s=w('input[name="jobs-career_id[]"]:checked').map(function(){return w(this).val()}).get()}else{s=w('select[name="jobs-career"]').val()}i=E.find(".sort-by.filter-control li.active a").data("sort");var y=w('.archive-layout select[name="sort_by"]').val();if(y){i=y}v=E.find('input[name="jobs_filter_salary_min"]').val();u=E.find('input[name="jobs_filter_salary_max"]').val();p=E.find('select[name="jobs_filter_rate"]').val();var j=w(".maptype").data("maptype");if(j=="google_map"){if(!N){D()}}else if(j=="openstreetmap"){var k=function(e,i){w(".maptype").remove();w(_).insertAfter("#pac-input");var t=w("#maps").data("key");var a=w("#maps").data("level");var n=w("#maps").data("style");var o=[];var r=[];var s=[];w.each(e,function(e,i){o.push({type:"Feature",geometry:{type:"Point",coordinates:[i.lat,i.lng]},properties:{iconSize:[40,40],id:i.id,icon:i.marker_icon,jobs:i.jobs}});r.push(i.lng);s.push(i.lat)});var l={type:"FeatureCollection",features:o};var c=0;for(var p=0;p<r.length;p++){c+=parseInt(r[p],10)}var m=0;if(c/r.length){m=c/r.length}var f=0;for(var p=0;p<s.length;p++){f+=parseInt(s[p],10)}var v=0;if(f/s.length){v=f/s.length}var u=L.DomUtil.get("maps");if(u!=null){u._leaflet_id=null}w(".leaflet-map-pane").remove();w(".leaflet-control-container").remove();var d=new L.map("maps");d.on("load",g);d.setView([v,m],a);function g(){var e="mapbox/"+n;L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token="+t,{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',id:e,tileSize:512,zoomOffset:-1,accessToken:t}).addTo(d);b()}function h(e){d.flyTo(e.geometry.coordinates,a)}if(!("remove"in Element.prototype)){Element.prototype.remove=function(){if(this.parentNode){this.parentNode.removeChild(this)}}}function b(){l.features.forEach(function(t){var e=document.createElement("div");e.id="marker-"+t.properties.id;e.className="marker";e.style.backgroundImage="url("+t.properties.icon+")";e.style.width=t.properties.iconSize[0]+"px";e.style.height=t.properties.iconSize[1]+"px";var i=L.divIcon({className:"marker-"+t.properties.id,html:'<div><img src="'+t.properties.icon+'" alt=""></div>',iconSize:[48,48]});var a=new L.marker([t.geometry.coordinates[0],t.geometry.coordinates[1]],{icon:i});a.addTo(d);if(J=="popup"){a.bindPopup(t.properties.jobs)}else{a.bindPopup()}e.addEventListener("click",function(e){h(t);var i=document.getElementsByClassName("active");e.stopPropagation();if(i[0]){i[0].classList.remove("active")}})})}if(!N){D()}}}else{var x=function(e,a){var i=w("#map").data("key");var t=w("#map").data("level");var n=w("#map").data("type");mapboxgl.accessToken=i;w(".mapboxgl-canary").remove();w(".mapboxgl-canvas-container").remove();w(".mapboxgl-control-container").remove();var o=[];var r=[];var s=[];w.each(e,function(e,i){o.push({type:"Feature",geometry:{type:"Point",coordinates:[i.lng,i.lat]},properties:{iconSize:[48,48],id:i.id,icon:i.marker_icon,jobs:i.jobs}});r.push(i.lng);s.push(i.lat)});var l=0;for(var c=0;c<r.length;c++){l+=parseInt(r[c],10)}var p=0;if(l/r.length){p=l/r.length}var m=0;for(var c=0;c<s.length;c++){m+=parseInt(s[c],10)}var f=0;if(m/s.length){f=m/s.length}var a=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/"+n,zoom:t,center:[p,f]});a.addControl(new mapboxgl.NavigationControl);var v={type:"FeatureCollection",features:o};a.on("load",function(e){a.addLayer({id:"locations",type:"symbol",source:{type:"geojson",data:v},layout:{"icon-image":"","icon-allow-overlap":true}});g()});function u(e){a.flyTo({center:e.geometry.coordinates,bearing:0,duration:0,speed:.2,curve:1,easing:function(e){return e}})}function d(e){var i=document.getElementsByClassName("mapboxgl-popup");if(i[0])i[0].remove();var t=new mapboxgl.Popup({closeOnClick:false}).setLngLat(e.geometry.coordinates).setHTML(e.properties.jobs).addTo(a)}if(!("remove"in Element.prototype)){Element.prototype.remove=function(){if(this.parentNode){this.parentNode.removeChild(this)}}}a.on("click",function(e){var i=a.queryRenderedFeatures(e.point,{layers:["locations"]});if(i.length){var t=i[0];u(t);d(t)}});function g(){v.features.forEach(function(t){var e=document.createElement("div");e.id="marker-"+t.properties.id;e.className="marker";e.style.backgroundImage="url("+t.properties.icon+")";e.style.width=t.properties.iconSize[0]+"px";e.style.height=t.properties.iconSize[1]+"px";new mapboxgl.Marker(e,{offset:[0,-23]}).setLngLat(t.geometry.coordinates).addTo(a);e.addEventListener("click",function(e){u(t);if(J=="popup"){d(t)}var i=document.getElementsByClassName("active");e.stopPropagation();if(i[0]){i[0].classList.remove("active")}})})}};if(!N){D()}}JOBS.elements.display_clear();var C=w(".area-jobs").attr("data-item-amount");if(C){B=C}var S=w(".civi-pagination").attr("data-type");w(".area-jobs .civi-jobs-item").addClass("skeleton-loading");w.ajax({dataType:"json",url:O,data:{action:"civi_jobs_archive_ajax",paged:h,title:e,item_amount:B,sort_by:i,categories:t,types:a,skills:l,experience:n,career:s,salary_min:v,salary_max:u,salary_rate:p,current_term:m,type_term:f,location:c,jobs_layout:d},beforeSend:function(){w(".civi-filter-search-map .civi-loading-effect").fadeIn();if(w(".form-jobs-top-filter .btn-top-filter").data("clicked")){w(".btn-top-filter .btn-loading").fadeIn()}},success:function(e){w(".btn-top-filter .btn-loading").fadeOut();if(j=="google_map"){if(T){P=new google.maps.Map(document.getElementById("jobs-map-filter"),civi_search_map_option);google.maps.event.trigger(P,"resize");if(e.success===true){if(e.jobs){var i=e.jobs.length}}if(i==1){var t=google.maps.event.addListener(P,"bounds_changed",function(e){this.setZoom(parseInt(googlemap_default_zoom));google.maps.event.removeListener(t)})}if(google_map_style!==""){var a=JSON.parse(google_map_style);P.setOptions({styles:a})}var n=new google.maps.LatLng("34.0207305","-118.6919226");P.setCenter(n);P.setZoom(parseInt(googlemap_default_zoom));google.maps.event.addListener(P,"tilesloaded",function(){w(".filter-jobs-search .civi-loading-effect").fadeOut()})}if(e.success===true){if(T){I.forEach(function(e){e.setMap(null)});I=[];civi_add_markers(e.jobs,P);civi_my_location(P);P.fitBounds(I.reduce(function(e,i){return e.extend(i.getPosition())},new google.maps.LatLngBounds))}if(o==true){if(e.pagination_type=="number"||r!=="loadmore"){w(".area-jobs").html(e.jobs_html);w(".filter-neighborhood").html(e.filter_html);w(".civi-pagination .pagination").html(e.pagination);w(".archive-layout .result-count").html(e.count_post)}else{w(".area-jobs").append(e.jobs_html);w(".filter-neighborhood").html(e.filter_html);if(e.hidden_pagination){w(".civi-pagination .pagination").html("")}w(".civi-pagination .pagination").removeClass("active")}JOBS.elements.waypoints()}if(T){google.maps.event.trigger(P,"resize");if(civi_template_vars.map_pin_cluster!=0){marker_cluster=new MarkerClusterer(P,I,{gridSize:60,styles:[{url:clusterIcon,width:66,height:65,textColor:"#fff"}]})}if(!N){civi_infowindow_hover_trigger()}}}else{if(o==true){if(e.pagination_type=="number"||r!=="loadmore"){w(".area-jobs").html('<div class="civi-ajax-result">'+z+"</div>");w(".archive-layout .result-count").html(e.count_post);w(".civi-pagination .pagination").html("")}else{w(".area-jobs").append(e.jobs_html);if(e.hidden_pagination){w(".civi-pagination .pagination").html("")}w(".civi-pagination .pagination").removeClass("active")}}}if(T){P.fitBounds(I.reduce(function(e,i){return e.extend(i.getPosition())},new google.maps.LatLngBounds));google.maps.event.trigger(P,"resize")}w(".area-jobs .civi-jobs-item").removeClass("skeleton-loading")}else if(j=="openstreetmap"){w(".civi-filter-search-map .civi-loading-effect").fadeOut();w(".area-jobs .civi-jobs-item").removeClass("skeleton-loading");if(T){k(e.jobs,maps)}if(e.success===true){if(o==true){if(e.pagination_type=="number"||r!=="loadmore"){w(".area-jobs").html(e.jobs_html);w(".filter-neighborhood").html(e.filter_html);w(".civi-pagination .pagination").html(e.pagination);w(".archive-layout .result-count").html(e.count_post)}else{w(".area-jobs").append(e.jobs_html);w(".filter-neighborhood").html(e.filter_html);if(e.hidden_pagination){w(".civi-pagination .pagination").html("")}w(".civi-pagination .pagination").removeClass("active")}JOBS.elements.waypoints()}}else{if(o==true){if(e.pagination_type=="number"||r!=="loadmore"){w(".area-jobs").html('<div class="civi-ajax-result">'+z+"</div>");w(".archive-layout .result-count").html(e.count_post);w(".civi-pagination .pagination").html("")}else{w(".area-jobs").append(e.jobs_html);if(e.hidden_pagination){w(".civi-pagination .pagination").html("")}w(".civi-pagination .pagination").removeClass("active")}}}}else{w(".civi-filter-search-map .civi-loading-effect").fadeOut();w(".area-jobs .civi-jobs-item").removeClass("skeleton-loading");if(T){x(e.jobs,map)}if(e.success===true){if(o==true){if(e.pagination_type=="number"||r!=="loadmore"){w(".area-jobs").html(e.jobs_html);w(".filter-neighborhood").html(e.filter_html);w(".civi-pagination .pagination").html(e.pagination);w(".archive-layout .result-count").html(e.count_post)}else{w(".area-jobs").append(e.jobs_html);w(".filter-neighborhood").html(e.filter_html);if(e.hidden_pagination){w(".civi-pagination .pagination").html("")}w(".civi-pagination .pagination").removeClass("active")}JOBS.elements.waypoints()}}else{if(o==true){if(e.pagination_type=="number"||r!=="loadmore"){w(".area-jobs").html('<div class="civi-ajax-result">'+z+"</div>");w(".archive-layout .result-count").html(e.count_post);w(".civi-pagination .pagination").html("")}else{w(".area-jobs").append(e.jobs_html);if(e.hidden_pagination){w(".civi-pagination .pagination").html("")}w(".civi-pagination .pagination").removeClass("active")}}}}if(!N){D()}}})}};JOBS.onReady={init:function(){JOBS.element.init()}};JOBS.onLoad={init:function(){}};JOBS.onScroll={init:function(){JOBS.elements.waypoints()}};w(window).scroll(JOBS.onScroll.init);w(document).ready(function(){JOBS.elements.init()});w(window).load(JOBS.onLoad.init)})(jQuery);