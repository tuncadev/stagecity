(function (s) {
	"use strict";
	var n = civi_avatar_vars.ajax_url,
		r = civi_avatar_vars.avatar_title,
		c = civi_avatar_vars.avatar_type,
		v = civi_avatar_vars.avatar_file_size,
		d = civi_avatar_vars.avatar_text,
		o = civi_avatar_vars.avatar_url,
		_ = civi_avatar_vars.avatar_upload_nonce;
	jQuery(document).ready(function () {
		var a = function () {
			var t = new plupload.Uploader({
				browse_button: "civi_select_avatar",
				file_data_name: "civi_avatar_upload_file",
				drop_element: "civi_avatar_view",
				container: "civi_avatar_container",
				url: o,
				filters: {
					mime_types: [{ title: r, extensions: c }],
					max_file_size: v,
					prevent_duplicates: true,
				},
			});
			t.init();
			t.bind("UploadProgress", function (a, i) {
				s("#civi_add_avatar .la-upload").hide();
				document.getElementById("civi_select_avatar").innerHTML =
					'<span><i class="fal fa-spinner fa-spin large"></i></span>';
			});
			t.bind("FilesAdded", function (a, i) {
				a.refresh();
				t.start();
			});
			t.bind("Error", function (a, i) {
				document.getElementById("civi_avatar_errors").innerHTML +=
					"Error #" + i.code + ": " + i.message + "<br/>";
			});
			var a = s("#civi_avatar_view").data("image-id");
			var i = s("#civi_avatar_view").data("image-url");
			if (a && i) {
				var e =
					'<figure class="media-thumb media-thumb-wrap">' +
					'<img src="' +
					i +
					'">' +
					'<div class="media-item-actions">' +
					'<a class="icon icon-avatar-delete" data-attachment-id="' +
					a +
					'" href="#" ><i class="far fa-trash-alt large"></i></a>' +
					'<span style="display: none;" class="icon icon-loader"><i class="fal fa-spinner fa-spin large"></i></span>' +
					"</div>" +
					"</figure>";
				s("#civi_avatar_view").html(e);
				s("#civi_add_avatar").hide();
			}
			t.bind("FileUploaded", function (a, i, t) {
				document.getElementById("civi_drop_avatar").style.display = "none";
				var e = s.parseJSON(t.response);
				if (e.success) {
					s("input.avatar_url").val(e.full_image);
					s("input.avatar_id").val(e.attachment_id);
					var r =
						'<figure class="media-thumb media-thumb-wrap">' +
						'<img src="' +
						e.full_image +
						'">' +
						'<div class="media-item-actions">' +
						'<a class="icon icon-avatar-delete" data-attachment-id="' +
						e.attachment_id +
						'" href="#" ><i class="far fa-trash-alt large"></i></a>' +
						'<span style="display: none;" class="icon icon-loader"><i class="fal fa-spinner fa-spin large"></i></span>' +
						"</div>" +
						"</figure>";
					s("#civi_avatar_view").html(r);
					l();
					s("#civi_add_avatar .la-upload").hide();
					s("#avatar_url-error").hide();
					if (s(".form-dashboard").hasClass("candidate-profile-form")) {
						s("#candidate-profile-form").find(".point-mark").change();
					}
				}
			});
		};
		a();
		var l = function (c) {
			s("body").on("click", ".icon-avatar-delete", function (a) {
				a.preventDefault();
				var i = s(this),
					t = i,
					e = i.closest("#civi_avatar_view").find(".media-thumb-wrap"),
					r = i.data("attachment-id"),
					l = s("#civi_drop_avatar");
				t.html('<i class="fal fa-spinner fa-spin large"></i>');
				s.ajax({
					type: "post",
					url: n,
					dataType: "json",
					data: {
						action: "civi_avatar_remove_ajax",
						attachment_id: r,
						type: c,
						removeNonce: _,
					},
					success: function (a) {
						if (a.success) {
							e.remove();
							e.hide();
							s("#avatar_url-error").show();
							s("#civi_add_avatar").show();
						}
						t.html('<i class="fal fa-spinner fa-spin large"></i>');
						l.css("display", "block");
						s("#civi_add_avatar .la-upload").show();
						s("#civi_select_avatar").html(d);
						s("input.avatar_url").val("");
						s("input.avatar_id").val("");
						if (s(".form-dashboard").hasClass("candidate-profile-form")) {
							s("#candidate-profile-form").find(".point-mark").change();
						}
					},
					error: function () {
						t.html('<i class="far fa-trash-alt large"></i>');
					},
				});
			});
		};
		l();
	});
})(jQuery);
