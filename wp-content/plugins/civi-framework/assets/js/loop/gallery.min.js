(function (n) {
	"use strict";
	var s = civi_gallery_vars.ajax_url,
		a = civi_gallery_vars.gallery_title,
		i = civi_gallery_vars.gallery_type,
		c = civi_gallery_vars.gallery_max_images,
		l = civi_gallery_vars.gallery_file_size,
		o = civi_gallery_vars.gallery_url,
		d = civi_gallery_vars.gallery_upload_nonce;
	jQuery(document).ready(function () {
		var e = function () {
			n("#civi_gallery_thumbs").sortable();
			var r = new plupload.Uploader({
				browse_button: "civi_select_gallery",
				file_data_name: "civi_gallery_upload_file",
				container: "civi_gallery_container",
				drop_element: "civi_gallery_container",
				multi_selection: true,
				url: o,
				filters: {
					mime_types: [{ title: a, extensions: i }],
					max_file_size: l,
					prevent_duplicates: true,
				},
			});
			r.init();
			r.bind("FilesAdded", function (e, a) {
				var i = "";
				var l = c;
				if (e.files.length > l) {
					e.splice(l);
					alert("no more than " + l + " file(s)");
					return;
				}
				plupload.each(a, function (e) {
					i += '<div id="holder-' + e.id + '"></div>';
				});
				document.getElementById("civi_gallery_thumbs").innerHTML += i;
				e.refresh();
				r.start();
			});
			r.bind("UploadProgress", function (e, a) {
				document.getElementById("holder-" + a.id).innerHTML =
					'<span><i class="fal fa-spinner fa-spin large"></i></span>';
			});
			r.bind("Error", function (e, a) {
				document.getElementById("civi_gallery_errors").innerHTML +=
					"Error: " + a.message + "<br/>";
			});
			r.bind("FileUploaded", function (e, a, i) {
				var l = n.parseJSON(i.response);
				if (l.success) {
					var r =
						'<figure class="media-thumb media-thumb-wrap">' +
						'<img src="' +
						l.url +
						'"/>' +
						'<div class="media-item-actions">' +
						'<a class="icon icon-gallery-delete" data-attachment-id="' +
						l.attachment_id +
						'" href="#" ><i class="far fa-trash-alt large"></i></a>' +
						'<input type="hidden" class="civi_gallery_ids" name="civi_gallery_ids[]" value="' +
						l.attachment_id +
						'"/>' +
						'<span style="display: none;" class="icon icon-loader"><i class="fal fa-spinner fa-spin large"></i></span>' +
						"</div>" +
						"</figure>";
					document.getElementById("holder-" + a.id).innerHTML = r;
					t("gallery");
					if (n(".form-dashboard").hasClass("candidate-profile-form")) {
						n("#candidate-profile-form").find(".point-mark").change();
					}
				}
			});
		};
		e();
		var t = function (t) {
			n("body").on("click", ".icon-gallery-delete", function (e) {
				e.preventDefault();
				var a = n(this),
					i = a,
					l = a.closest(".media-thumb-wrap"),
					r = a.data("attachment-id");
				i.html('<i class="fal fa-spinner fa-spin large"></i>');
				n.ajax({
					type: "post",
					url: s,
					dataType: "json",
					data: {
						action: "civi_gallery_remove_ajax",
						attachment_id: r,
						type: t,
						removeNonce: d,
					},
					success: function (e) {
						if (e.success) {
							l.remove();
							l.hide();
							n("#featured_image_url-error").show();
						}
						i.html('<i class="fal fa-spinner fa-spin large"></i>');
						if (n(".form-dashboard").hasClass("candidate-profile-form")) {
							n("#candidate-profile-form").find(".point-mark").change();
						}
					},
					error: function () {
						i.html('<i class="far fa-trash-alt large"></i>');
					},
				});
			});
		};
		t("gallery");
	});
})(jQuery);
