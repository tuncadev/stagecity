(function (r) {
	"use strict";
	var s = civi_thumbnail_vars.ajax_url,
		e = civi_thumbnail_vars.thumbnail_title,
		c = civi_thumbnail_vars.thumbnail_type,
		m = civi_thumbnail_vars.thumbnail_file_size,
		u = civi_thumbnail_vars.thumbnail_text,
		d = civi_thumbnail_vars.thumbnail_url,
		o = civi_thumbnail_vars.thumbnail_upload_nonce;
	jQuery(document).ready(function () {
		var i = function () {
			var l = new plupload.Uploader({
				browse_button: "civi_select_thumbnail",
				file_data_name: "civi_thumbnail_upload_file",
				drop_element: "civi_thumbnail_view",
				container: "civi_thumbnail_container",
				url: d,
				filters: {
					mime_types: [{ title: e, extensions: c }],
					max_file_size: m,
					prevent_duplicates: true,
				},
			});
			l.init();
			l.bind("UploadProgress", function (i, a) {
				document.getElementById("civi_select_thumbnail").innerHTML =
					'<span><i class="fal fa-spinner fa-spin large"></i></span>';
			});
			l.bind("FilesAdded", function (i, a) {
				i.refresh();
				l.start();
			});
			l.bind("Error", function (i, a) {
				document.getElementById("civi_thumbnail_errors").innerHTML +=
					"Error #" + a.code + ": " + a.message + "<br/>";
			});
			var i = r("#civi_thumbnail_view").data("image-id");
			var a = r("#civi_thumbnail_view").data("image-url");
			if (i && a) {
				var t =
					'<figure class="media-thumb media-thumb-wrap">' +
					'<img src="' +
					a +
					'">' +
					'<div class="media-item-actions">' +
					'<a class="icon icon-thumbnail-delete" data-attachment-id="' +
					i +
					'" href="#" ><i class="far fa-trash-alt large"></i></a>' +
					'<span style="display: none;" class="icon icon-loader"><i class="fal fa-spinner fa-spin large"></i></span>' +
					"</div>" +
					"</figure>";
				r("#civi_thumbnail_view").html(t);
				r("#civi_add_thumbnail").hide();
			}
			l.bind("FileUploaded", function (i, a, l) {
				document.getElementById("civi_drop_thumbnail").style.display = "none";
				var t = r.parseJSON(l.response);
				if (t.success) {
					r("input.thumbnail_url").val(t.full_image);
					r("input.thumbnail_id").val(t.attachment_id);
					var e =
						'<figure class="media-thumb media-thumb-wrap">' +
						'<img src="' +
						t.full_image +
						'">' +
						'<div class="media-item-actions">' +
						'<a class="icon icon-thumbnail-delete" data-attachment-id="' +
						t.attachment_id +
						'" href="#" ><i class="far fa-trash-alt large"></i></a>' +
						'<span style="display: none;" class="icon icon-loader"><i class="fal fa-spinner fa-spin large"></i></span>' +
						"</div>" +
						"</figure>";
					r("#civi_thumbnail_view").html(e);
					n();
					r("#civi_add_thumbnail .la-upload").hide();
					r("#thumbnail_url-error").hide();
					if (r(".form-dashboard").hasClass("candidate-profile-form")) {
						r("#candidate-profile-form").find(".point-mark").change();
					}
				}
			});
		};
		i();
		var n = function (c) {
			r("body").on("click", ".icon-thumbnail-delete", function (i) {
				i.preventDefault();
				var a = r(this),
					l = a,
					t = a.closest("#civi_thumbnail_view").find(".media-thumb-wrap"),
					e = a.data("attachment-id"),
					n = r("#civi_drop_thumbnail");
				l.html('<i class="fal fa-spinner fa-spin large"></i>');
				r.ajax({
					type: "post",
					url: s,
					dataType: "json",
					data: {
						action: "civi_thumbnail_remove_ajax",
						attachment_id: e,
						type: c,
						removeNonce: o,
					},
					success: function (i) {
						if (i.success) {
							t.remove();
							t.hide();
							r("#thumbnail_url-error").show();
							r("#civi_add_thumbnail").show();
						}
						l.html('<i class="fal fa-spinner fa-spin large"></i>');
						n.css("display", "block");
						r("#civi_add_thumbnail .la-upload").show();
						r("#civi_select_thumbnail").html(u);
						r("input.thumbnail_url").val("");
						r("input.thumbnail_id").val("");
						if (r(".form-dashboard").hasClass("candidate-profile-form")) {
							r("#candidate-profile-form").find(".point-mark").change();
						}
					},
					error: function () {
						l.html('<i class="far fa-trash-alt large"></i>');
					},
				});
			});
		};
		n();
	});
})(jQuery);
