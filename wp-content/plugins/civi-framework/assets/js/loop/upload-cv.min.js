(function (n) {
	"use strict";
	var o = civi_upload_cv_vars.ajax_url,
		e = civi_upload_cv_vars.title,
		t = civi_upload_cv_vars.cv_file,
		l = civi_upload_cv_vars.cv_max_file_size,
		s = civi_upload_cv_vars.text,
		r = civi_upload_cv_vars.url,
		_ = civi_upload_cv_vars.upload_nonce;
	n(document).ready(function () {
		var a = function () {
			var c = new plupload.Uploader({
				browse_button: "civi_select_cv",
				file_data_name: "civi_thumbnail_upload_file",
				drop_element: "civi_select_cv",
				container: "civi_cv_plupload_container",
				url: r,
				filters: {
					mime_types: [{ title: e, extensions: t }],
					max_file_size: l,
					prevent_duplicates: true,
				},
			});
			c.init();
			c.bind("UploadProgress", function (a, i) {
				n("#civi_select_cv i").removeClass("far fa-arrow-from-bottom large");
				n("#civi_select_cv i").addClass("fal fa-spinner fa-spin large");
			});
			c.bind("FilesAdded", function (a, i) {
				var e = 1;
				a.refresh();
				c.start();
			});
			c.bind("Error", function (a, i) {
				document.getElementById("cv_errors_log").innerHTML +=
					"Error #" + i.code + ": " + i.message + "<br/>";
			});
			c.bind("FileUploaded", function (a, i, e) {
				var c = n.parseJSON(e.response);
				if (c.success) {
					n(".cv_url").val(c.url);
					n("#civi_drop_cv").attr("data-attachment-id", c.attachment_id);
					n("#civi_drop_cv").append(
						'<a class="icon cv-icon-delete" data-jobs-id="0"  data-attachment-id="' +
							c.attachment_id +
							'" href="#" ><i class="far fa-trash-alt large"></i></a>'
					);
					var t =
						'<i class="far fa-arrow-from-bottom large"></i><span>' +
						c.title +
						"</span>";
					n("#civi_select_cv i").addClass("far fa-arrow-from-bottom large");
					n("#civi_select_cv").html(t);
					n("#cv_url-error").hide();
					n("#candidate-profile-form").find(".point-mark").change();
				}
			});
		};
		a();
		var i = function (r) {
			n("body").on("click", ".cv-icon-delete", function (a) {
				a.preventDefault();
				var i = n(this),
					e = i,
					c = i.closest(".media-thumb-wrap"),
					t = i.data("jobs-id"),
					l = i.data("attachment-id");
				e.html('<i class="fal fa-spinner fa-spin large"></i>');
				n.ajax({
					type: "post",
					url: o,
					dataType: "json",
					data: {
						action: "civi_thumbnail_remove_ajax",
						jobs_id: t,
						attachment_id: l,
						type: r,
						removeNonce: _,
					},
					beforeSend: function () {
						e.html('<i class="fal fa-spinner fa-spin large"></i>');
					},
					success: function (a) {
						if (a.success) {
							n("#cv_url-error").show();
							n(".civi_cv_file").show();
						}
						n("#civi_select_cv").html(s);
						n("#civi_drop_cv").attr("data-attachment-id", "");
						n("#candidate-profile-form").find(".point-mark").change();
						e.remove();
					},
					error: function () {
						e.html('<i class="far fa-trash-alt large"></i>');
					},
				});
			});
		};
		i("thumb");
	});
})(jQuery);
